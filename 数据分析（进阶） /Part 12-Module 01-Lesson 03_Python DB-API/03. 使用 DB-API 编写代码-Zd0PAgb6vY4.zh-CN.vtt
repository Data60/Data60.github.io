WEBVTT
Kind: captions
Language: zh-CN

00:00:00.240 --> 00:00:03.850
这里是一个 Python 程序使用 DB-API 库来访问数据库

00:00:03.850 --> 00:00:05.350
的一个例子

00:00:05.350 --> 00:00:07.600
当你每次在代码中使用 DB-API 的时候

00:00:07.600 --> 00:00:09.960
你都要按照下面的步骤来

00:00:09.960 --> 00:00:13.100
首先导入 sqlite3  这个库所针对的

00:00:13.100 --> 00:00:14.580
就是我们使用的数据库

00:00:14.580 --> 00:00:19.340
但如果我们使用的是 postgreSQL 的话 就要导入 psyco-pg 了

00:00:19.340 --> 00:00:21.590
接下来 连接数据库

00:00:21.590 --> 00:00:25.120
这里的字符串 cookies 就是要连接数据库的名字

00:00:25.120 --> 00:00:27.730
我在这里把它叫做 cookies 是有原因的

00:00:27.730 --> 00:00:30.380
视频结束的时候我会告诉你的 我保证

00:00:30.380 --> 00:00:34.050
如果通过网络来使用数据库 你就必须要

00:00:34.050 --> 00:00:38.450
在这里指定主机名称 用户名 密码 还有其他的信息

00:00:38.450 --> 00:00:41.370
连接函数返回一个连接对象

00:00:41.370 --> 00:00:43.910
在你断开连接之前都能用

00:00:43.910 --> 00:00:47.150
接下来 你的代码就会产生出一个叫做光标的对象

00:00:47.150 --> 00:00:50.730
这个光标就会去运行查询语句并获得结果

00:00:50.730 --> 00:00:53.840
之所以叫它光标 是因为当数据库给你结果时

00:00:53.840 --> 00:00:55.780
你会用光标来观测这些结果

00:00:55.780 --> 00:00:58.260
就像文字编辑器里的光标一样

00:00:58.260 --> 00:01:02.060
你看 我们执行一条查询语句用到了光标

00:01:02.060 --> 00:01:05.880
接着从查询语句中获取结果也要用到光标

00:01:05.880 --> 00:01:08.810
还有一种情况是 每次只获取一个结果

00:01:08.810 --> 00:01:10.950
使用光标的 fetchone 方法

00:01:10.950 --> 00:01:14.550
好 如果你发出一条 insert 命令而不是 select

00:01:14.550 --> 00:01:18.980
你就要在这提交（commit）这次的插入 否则如果发生了错误 就回滚（roll back）至原状态

00:01:18.980 --> 00:01:22.410
对于其他的改变数据库的命令也是一样的

00:01:22.410 --> 00:01:25.300
提交（commit）和 回滚（roll back）是连接的方法

00:01:25.300 --> 00:01:28.550
这个情况 我们做的是一个 select 所以就不用了

00:01:28.550 --> 00:01:29.730
我会在后面深入讲解提交（commit）和回滚（roll back）的

00:01:29.730 --> 00:01:33.450
并且还会说一下插入和 DB-API 

00:01:33.450 --> 00:01:36.720
最后 完成任务后 你要关闭连接

00:01:36.720 --> 00:01:39.600
每次完成后都关闭连接是非常重要的

00:01:39.600 --> 00:01:42.410
特别是当这段代码还运行在循环体中时

00:01:42.410 --> 00:01:44.980
谁都不想让一大堆废弃的连接占用

00:01:44.980 --> 00:01:46.900
大量资源

00:01:46.900 --> 00:01:50.055
对了 我前面提到了 cookies 并不是瞎编搞笑的

00:01:50.055 --> 00:01:53.455
如果你对 Chrome 浏览器的 cookies 文件运行这些代码

00:01:53.455 --> 00:01:56.745
你就能得到一些有 cookies 记录的 Web 服务信息

00:01:56.745 --> 00:01:57.325
这是因为 Chrome

00:01:57.325 --> 00:02:00.815
和 Firefox 都使用 SQLite 数据库来存储 cookies 和历史记录

